<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>544 Health AI Tracker | Healthcare IT & AI Intelligence</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0; --slate-300: #cbd5e1; --slate-400: #94a3b8; --slate-500: #64748b; --slate-600: #475569; --slate-700: #334155; --slate-800: #1e293b; --slate-900: #0f172a;
            /* Primary Theme - BLUE (changed from green) */
            --primary-50: #eff6ff; --primary-100: #dbeafe; --primary-500: #3b82f6; --primary-600: #2563eb; --primary-700: #1d4ed8;
            --indigo-50: #eef2ff; --indigo-100: #e0e7ff; --indigo-500: #6366f1; --indigo-600: #4f46e5;
            --amber-500: #f59e0b;
            --orange-500: #ff6b35; /* For logo accent */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05); --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem; --radius: 0.5rem; --radius-lg: 0.75rem; --radius-xl: 1rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--slate-50); color: var(--slate-800); line-height: 1.5; }
        
        /* ===== LOGO STYLING ===== */
        .logo-544-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .logo-icon { background-color: var(--primary-600); color: white; padding: 0.5rem; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; }
        .logo-icon i { font-size: 1.25rem; }
        .logo-544 {
            font-family: 'Inter', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
            color: var(--primary-600);
            text-align: center;
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f0f7ff 0%, #e1eeff 100%);
            box-shadow: 0 3px 8px rgba(37, 99, 235, 0.12);
            position: relative;
            overflow: hidden;
            line-height: 1;
        }
        .logo-544 .highlight {
            color: var(--orange-500);
            text-shadow: 1px 1px 2px rgba(255, 107, 53, 0.2);
            margin-right: 2px;
        }
        .logo-544::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-600), var(--orange-500));
        }
        .logo-subtitle {
            font-size: 0.625rem;
            color: var(--primary-600);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: block;
            margin-top: 0.125rem;
        }
        
        .app-container { display: flex; min-height: 100vh; }
        .sidebar { width: 16rem; background-color: white; border-right: 1px solid var(--slate-200); display: flex; flex-direction: column; position: sticky; top: 0; height: 100vh; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--slate-100); }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: 1.5rem 0.75rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .nav-section { display: flex; flex-direction: column; gap: 0.25rem; }
        .nav-label { font-size: 0.75rem; font-weight: 600; color: var(--slate-400); text-transform: uppercase; letter-spacing: 0.05em; padding: 0 0.75rem; margin-bottom: 0.5rem; }
        .nav-item { width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 0.75rem; border-radius: var(--radius); background: none; border: none; color: var(--slate-600); cursor: pointer; transition: all 0.15s ease; font-size: 0.875rem; text-align: left; }
        .nav-item:hover { background-color: var(--slate-50); }
        .nav-item.active { background-color: var(--primary-50); color: var(--primary-700); font-weight: 500; }
        .nav-item-content { display: flex; align-items: center; gap: 0.75rem; }
        .nav-item i { width: 1rem; font-size: 0.875rem; }
        .unread-count { background-color: var(--primary-600); color: white; font-size: 0.625rem; padding: 0.125rem 0.375rem; border-radius: 9999px; min-width: 1.25rem; text-align: center; font-weight: 500; }
        .source-dot { width: 0.5rem; height: 0.5rem; border-radius: 50%; background-color: var(--slate-300); }
        .nav-item.active .source-dot { background-color: var(--primary-500); }
        .source-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
        .sidebar-footer { padding: 1rem; border-top: 1px solid var(--slate-100); text-align: center; }
        .footer-label { font-size: 0.5625rem; color: var(--slate-400); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; min-width: 0; height: 100vh; overflow: hidden; }
        .main-header { background-color: white; border-bottom: 1px solid var(--slate-200); padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 10; }
        .search-container { display: flex; align-items: center; gap: 1rem; flex: 1; max-width: 42rem; }
        .search-box { position: relative; flex: 1; }
        .search-box i { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--slate-400); font-size: 0.875rem; }
        .search-box input { width: 100%; padding: 0.5rem 0.75rem 0.5rem 2.25rem; border: 1px solid var(--slate-200); border-radius: var(--radius-xl); background-color: var(--slate-50); font-size: 0.875rem; outline: none; transition: all 0.2s; }
        .search-box input:focus { border-color: var(--primary-500); box-shadow: 0 0 0 2px var(--primary-100); }
        .refresh-btn { display: flex; align-items: center; gap: 0.5rem; background-color: var(--slate-100); color: var(--slate-700); padding: 0.5rem 1rem; border-radius: var(--radius-xl); border: none; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s; }
        .refresh-btn:hover { background-color: var(--slate-200); }
        .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .refresh-btn i.fa-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .refresh-text { display: none; }
        @media (min-width: 640px) { .refresh-text { display: inline; } }
        .header-status { display: flex; align-items: center; gap: 1rem; margin-left: 2rem; }
        .scanner-status { display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--primary-600); text-transform: uppercase; letter-spacing: 0.05em; }
        .status-dot { width: 0.5rem; height: 0.5rem; border-radius: 50%; background-color: var(--primary-500); animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .content-area { flex: 1; overflow-y: auto; background-color: var(--slate-50); }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--slate-100); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--slate-300); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--slate-400); }
        .feed-header { padding: 2rem 2rem 0; max-width: 80rem; margin: 0 auto; display: flex; align-items: flex-end; justify-content: space-between; margin-bottom: 2rem; }
        .feed-title h2 { font-size: 1.5rem; font-weight: 800; color: var(--slate-900); letter-spacing: -0.025em; }
        .feed-title p { color: var(--slate-500); font-size: 0.875rem; margin-top: 0.25rem; }
        .reset-filter-btn { color: var(--primary-600); font-size: 0.875rem; font-weight: 700; background: none; border: none; cursor: pointer; text-decoration: underline; }
        .reset-filter-btn:hover { color: var(--primary-700); }
        .reset-filter-btn.hidden { display: none; }
        
        .loading-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 6rem 2rem; gap: 1rem; }
        .spinner { width: 3rem; height: 3rem; border: 4px solid var(--primary-500); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        .loading-state p { color: var(--slate-500); font-weight: 500; }
        .articles-grid { padding: 0 2rem 2rem; max-width: 80rem; margin: 0 auto; display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        @media (min-width: 768px) { .articles-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .articles-grid { grid-template-columns: repeat(3, 1fr); } }
        .article-card { background-color: white; border: 1px solid var(--slate-200); border-radius: var(--radius-xl); overflow: hidden; display: flex; flex-direction: column; height: 100%; transition: box-shadow 0.2s; }
        .article-card:hover { box-shadow: var(--shadow-md); }
        .article-body { padding: 1.25rem; flex: 1; }
        .article-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; }
        .article-source { font-size: 0.625rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--primary-600); background-color: var(--primary-50); padding: 0.25rem 0.5rem; border-radius: var(--radius); }
        .bookmark-btn { background: none; border: none; color: var(--slate-300); cursor: pointer; transition: color 0.2s; font-size: 1.125rem; }
        .bookmark-btn:hover { color: var(--slate-500); }
        .bookmark-btn.active { color: var(--amber-500); }
        .bookmark-btn.active i { font-weight: 900; }
        .article-title { font-size: 1.125rem; font-weight: 700; color: var(--slate-800); margin-bottom: 0.5rem; line-height: 1.3; }
        .article-title a { color: inherit; text-decoration: none; }
        .article-title a:hover { color: var(--primary-700); }
        .article-meta { display: flex; gap: 0.75rem; font-size: 0.75rem; color: var(--slate-500); margin-bottom: 1rem; }
        .article-meta span { display: flex; align-items: center; gap: 0.25rem; }
        .article-summary { color: var(--slate-600); font-size: 0.875rem; line-height: 1.5; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .ai-insight { background-color: var(--indigo-50); border: 1px solid var(--indigo-100); border-radius: var(--radius-lg); padding: 0.75rem; margin-bottom: 1rem; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .ai-header { display: flex; align-items: center; gap: 0.5rem; font-size: 0.625rem; font-weight: 700; color: var(--indigo-600); text-transform: uppercase; margin-bottom: 0.25rem; }
        .ai-text { color: var(--slate-700); font-size: 0.75rem; font-style: italic; line-height: 1.4; }
        .hidden { display: none !important; }
        .article-tags { display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: auto; }
        .article-tags span { font-size: 0.625rem; background-color: var(--slate-100); color: var(--slate-500); padding: 0.25rem 0.5rem; border-radius: 9999px; }
        .article-footer { padding: 1rem 1.25rem; border-top: 1px solid var(--slate-100); background-color: var(--slate-50); display: flex; gap: 0.75rem; }
        .ai-insight-btn, .read-full-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem; border-radius: var(--radius-lg); font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .ai-insight-btn { background-color: white; border: 1px solid var(--indigo-200); color: var(--indigo-600); }
        .ai-insight-btn:hover { background-color: var(--indigo-50); }
        .ai-insight-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .ai-insight-btn i.fa-spin { animation: spin 1s linear infinite; }
        .read-full-btn { background-color: var(--primary-600); color: white; border: none; box-shadow: 0 1px 2px 0 rgba(59, 130, 246, 0.1); }
        .read-full-btn:hover { background-color: var(--primary-700); }
        
        .empty-state { text-align: center; padding: 6rem 2rem; background-color: white; border-radius: 1.5rem; border: 2px dashed var(--slate-200); max-width: 48rem; margin: 0 auto; }
        .empty-icon { background-color: var(--slate-50); width: 5rem; height: 5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; }
        .empty-icon i { font-size: 3rem; color: var(--slate-300); }
        .empty-state h3 { font-size: 1.125rem; font-weight: 700; color: var(--slate-800); margin-bottom: 0.5rem; }
        .empty-state p { color: var(--slate-500); max-width: 20rem; margin: 0 auto; }
        
        @media (max-width: 768px) { .app-container { flex-direction: column; } .sidebar { width: 100%; height: auto; position: static; border-right: none; border-bottom: 1px solid var(--slate-200); } .sidebar-nav { flex-direction: row; overflow-x: auto; padding: 1rem; gap: 1rem; } .nav-section { min-width: fit-content; } .main-header { padding: 1rem; flex-direction: column; gap: 1rem; } .search-container { max-width: 100%; } .header-status { margin-left: 0; } .feed-header, .articles-grid { padding: 1rem; } }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <!-- UPDATED LOGO WITH "544" -->
                <div class="logo-544-container">
                    <div class="logo-icon"><i class="fas fa-microchip"></i></div>
                    <div class="logo-text">
                        <div class="logo-544">
                            <span class="highlight">544</span> Health AI Tracker
                        </div>
                        <span class="logo-subtitle">Healthcare Intelligence Platform</span>
                    </div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-label">Navigation</div>
                    <button class="nav-item active" data-view="feed">
                        <div class="nav-item-content"><i class="fas fa-bolt"></i><span>AI Live Feed</span></div>
                        <span class="unread-count" id="unread-count">0</span>
                    </button>
                    <button class="nav-item" data-view="bookmarks">
                        <div class="nav-item-content"><i class="fas fa-bookmark"></i><span>Research Vault</span></div>
                    </button>
                </div>
                <div class="nav-section">
                    <div class="nav-label">Focus Areas</div>
                    <button class="nav-item active source-item" data-source="all">
                        <div class="nav-item-content"><i class="fas fa-layer-group"></i><span>All AI Topics</span></div>
                    </button>
                    <div id="source-list"></div>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="footer-label">544 Health AI Tracker v2.0</div>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Search Health IT & AI breakthroughs...">
                    </div>
                    <button id="refresh-btn" class="refresh-btn">
                        <i class="fas fa-sync-alt"></i><span class="refresh-text">Refresh</span>
                    </button>
                </div>
                <div class="header-status">
                    <div class="scanner-status">
                        <span class="status-dot"></span>544 AI SCANNER ACTIVE
                    </div>
                </div>
            </header>

            <div class="content-area custom-scrollbar">
                <div id="feed-content">
                    <div class="feed-header">
                        <div class="feed-title">
                            <h2 id="feed-title">544 Health AI Tracker</h2>
                            <p id="feed-subtitle">Monitoring specialized AI developments across Healthcare & Pharma.</p>
                        </div>
                        <button id="reset-filter-btn" class="reset-filter-btn hidden">Reset Filter</button>
                    </div>
                    <div id="loading-state" class="loading-state">
                        <div class="spinner"></div>
                        <p>Fetching latest AI insights from 9 sources...</p>
                    </div>
                    <div id="articles-grid" class="articles-grid hidden"></div>
                    <div id="empty-state" class="empty-state hidden">
                        <div class="empty-icon"><i class="fas fa-microchip"></i></div>
                        <h3>No AI articles found</h3>
                        <p>Try refreshing or checking your filter settings.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <template id="article-template">
        <div class="article-card">
            <div class="article-body">
                <div class="article-header">
                    <span class="article-source"></span>
                    <button class="bookmark-btn"><i class="far fa-bookmark"></i></button>
                </div>
                <h3 class="article-title"><a href="#" target="_blank" rel="noopener noreferrer"></a></h3>
                <div class="article-meta">
                    <span class="article-date"><i class="far fa-calendar"></i><span class="date-text"></span></span>
                    <span class="article-author"><i class="far fa-user"></i><span class="author-text"></span></span>
                </div>
                <p class="article-summary"></p>
                <div class="ai-insight hidden">
                    <div class="ai-header"><i class="fas fa-sparkles"></i>AI Insight</div>
                    <p class="ai-text"></p>
                </div>
                <div class="article-tags"></div>
            </div>
            <div class="article-footer">
                <button class="ai-insight-btn"><i class="fas fa-wand-magic-sparkles"></i>Get AI Insight</button>
                <a href="#" target="_blank" rel="noopener noreferrer" class="read-full-btn">Read Full<i class="fas fa-external-link-alt"></i></a>
            </div>
        </div>
    </template>

    <script>
        // ===== CONSTANTS =====
        const DEFAULT_SOURCES = [
            { id: 'healthcare-it-today', name: 'Healthcare IT Today', url: 'https://www.healthcareittoday.com/feed/', homepage: 'https://www.healthcareittoday.com/', category: 'Health IT & AI', enabled: true },
            { id: 'nejm-ai-podcast', name: 'NEJM AI Podcast', url: 'https://ai-podcast.nejm.org/feed.xml', homepage: 'https://ai-podcast.nejm.org/', category: 'Clinical AI', enabled: true },
            { id: 'bmj-digital-health', name: 'BMJ Digital Health', url: 'https://bmjdigitalhealth.bmj.com/rss/current.xml', homepage: 'https://bmjdigitalhealth.bmj.com/', category: 'Medical AI', enabled: true },
            { id: 'healthtech-magazines', name: 'Healthtech Magazines', url: 'https://www.healthtechmagazines.com/feed/', homepage: 'https://www.healthtechmagazines.com/', category: 'Health Tech', enabled: true },
            { id: 'ai-news', name: 'Artificial Intelligence News', url: 'https://www.artificialintelligence-news.com/feed/', homepage: 'https://www.artificialintelligence-news.com/', category: 'General AI', enabled: true },
            { id: 'latch-bio', name: 'Latch Bio Blog', url: 'https://blog.latch.bio/feed', homepage: 'https://blog.latch.bio/', category: 'Bioinformatics', enabled: true },
            { id: 'intelligent-health', name: 'Intelligent Health AI', url: 'https://blog.intelligenthealth.ai/rss.xml', homepage: 'https://blog.intelligenthealth.ai/', category: 'Health AI', enabled: true },
            { id: 'ai-and-health', name: 'AI and Health', url: 'https://www.aiandhealth.com/blog-feed.xml', homepage: 'https://www.aiandhealth.com/', category: 'Health AI', enabled: true },
            { id: 'bayesian-health', name: 'Bayesian Health', url: 'https://www.bayesianhealth.com/feed/', homepage: 'https://www.bayesianhealth.com/', category: 'Clinical AI', enabled: true }
        ];
        const AI_KEYWORDS = ['ai', 'artificial intelligence', 'machine learning', 'deep learning', 'neural network', 'algorithm', 'llm', 'gpt', 'nlp', 'computer vision', 'predictive model', 'automation'];
        const CORS_PROXY = 'https://corsproxy.io/?';

        // ===== STATE =====
        let state = {
            currentView: 'feed',
            articles: [],
            loading: true,
            searchQuery: '',
            activeSourceId: 'all',
            config: { refreshInterval: 60, sources: DEFAULT_SOURCES },
            bookmarks: new Set()
        };

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            setupEvents();
            renderSidebar();
            fetchAndDisplayArticles();
        });

        // ===== FUNCTIONS =====
        function loadState() {
            try {
                const savedConfig = localStorage.getItem('544_health_ai_config');
                if (savedConfig) {
                    const parsed = JSON.parse(savedConfig);
                    // Merge with default sources to ensure new sources are included
                    state.config.sources = DEFAULT_SOURCES.map(defaultSource => {
                        const savedSource = parsed.sources?.find(s => s.id === defaultSource.id);
                        return savedSource ? { ...defaultSource, enabled: savedSource.enabled } : defaultSource;
                    });
                }
                const savedBookmarks = localStorage.getItem('544_health_ai_bookmarks');
                if (savedBookmarks) state.bookmarks = new Set(JSON.parse(savedBookmarks));
            } catch (e) { console.error('Load error:', e); }
        }

        function saveState() {
            try {
                localStorage.setItem('544_health_ai_config', JSON.stringify(state.config));
                localStorage.setItem('544_health_ai_bookmarks', JSON.stringify([...state.bookmarks]));
            } catch (e) { console.error('Save error:', e); }
        }

        function setupEvents() {
            document.querySelectorAll('.nav-item[data-view]').forEach(btn => btn.addEventListener('click', function() {
                document.querySelectorAll('.nav-item[data-view]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.currentView = this.dataset.view;
                if (state.currentView === 'bookmarks') {
                    document.getElementById('feed-title').textContent = 'Research Vault';
                    document.getElementById('feed-subtitle').textContent = 'Your bookmarked AI articles';
                } else {
                    document.getElementById('feed-title').textContent = '544 Health AI Tracker';
                    document.getElementById('feed-subtitle').textContent = 'Monitoring specialized AI developments across Healthcare & Pharma.';
                }
                renderArticles();
            }));

            document.getElementById('search-input').addEventListener('input', e => {
                state.searchQuery = e.target.value.toLowerCase();
                renderArticles();
            });

            document.getElementById('refresh-btn').addEventListener('click', () => {
                fetchAndDisplayArticles();
            });
        }

        async function fetchAndDisplayArticles() {
            state.loading = true;
            renderLoading();
            
            try {
                const enabledSources = state.config.sources.filter(s => s.enabled);
                const allResults = await Promise.allSettled(enabledSources.map(fetchFeed));
                
                let flatItems = [];
                allResults.forEach((result, index) => {
                    if (result.status === 'fulfilled') {
                        flatItems = flatItems.concat(result.value);
                    } else {
                        console.error(`Failed to fetch ${enabledSources[index].name}:`, result.reason);
                    }
                });
                
                // Sort by date (newest first)
                flatItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
                
                // Filter for AI content
                const aiFiltered = flatItems.filter(item => {
                    const content = (item.title + ' ' + item.summary).toLowerCase();
                    return AI_KEYWORDS.some(keyword => 
                        keyword === 'ai' ? content.split(/\W+/).includes('ai') : content.includes(keyword)
                    );
                });
                
                state.articles = aiFiltered.map(item => ({
                    ...item,
                    bookmarked: state.bookmarks.has(item.id)
                }));
                
            } catch (error) {
                console.error('Fetch error:', error);
                // Fallback sample articles
                state.articles = DEFAULT_SOURCES.filter(s => s.enabled).map((source, idx) => ({
                    id: `sample-${idx}`,
                    title: `Sample: AI Breakthrough in ${source.category}`,
                    link: source.homepage,
                    pubDate: new Date(Date.now() - idx * 86400000).toISOString(),
                    summary: `Sample article showing AI developments in ${source.category}. This is placeholder content.`,
                    author: source.name,
                    categories: [source.category, 'AI'],
                    sourceName: source.name,
                    sourceUrl: source.homepage,
                    bookmarked: idx % 3 === 0
                }));
            }
            
            state.loading = false;
            renderArticles();
            renderSidebar();
            saveState();
        }

        async function fetchFeed(source) {
            try {
                const response = await fetch(`${CORS_PROXY}${encodeURIComponent(source.url)}`, {
                    headers: { 'Accept': 'application/xml' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                // Check for parse errors
                const parseError = xmlDoc.querySelector('parsererror');
                if (parseError) {
                    throw new Error('Failed to parse XML');
                }
                
                // Handle both RSS and Atom feeds
                const items = xmlDoc.querySelectorAll('item, entry');
                
                return Array.from(items).map(item => {
                    const title = item.querySelector('title')?.textContent || 'Untitled';
                    let link = item.querySelector('link')?.textContent || 
                              item.querySelector('link')?.getAttribute('href') || 
                              item.querySelector('id')?.textContent || 
                              '#';
                    
                    // For Atom feeds with link elements
                    if (!link || link === '#') {
                        const atomLink = item.querySelector('link[rel="alternate"]');
                        if (atomLink) link = atomLink.getAttribute('href') || '#';
                    }
                    
                    const pubDate = item.querySelector('pubDate, published, updated')?.textContent || new Date().toISOString();
                    const summary = item.querySelector('description, summary, content')?.textContent || '';
                    const author = item.querySelector('author, creator')?.textContent || 
                                 item.querySelector('dc\\:creator')?.textContent || 
                                 source.name;
                    
                    const categories = Array.from(item.querySelectorAll('category, category term'))
                        .map(cat => cat.textContent || cat.getAttribute('term'))
                        .filter(Boolean);
                    
                    return {
                        id: btoa(link).slice(0, 16),
                        title: title.trim(),
                        link: link.trim(),
                        pubDate: new Date(pubDate).toISOString(),
                        summary: summary.replace(/<[^>]*>/g, '').slice(0, 200).trim() + '...',
                        author: author.trim(),
                        categories: categories.length > 0 ? categories : [source.category],
                        sourceName: source.name,
                        sourceUrl: source.homepage,
                        bookmarked: state.bookmarks.has(btoa(link).slice(0, 16))
                    };
                });
                
            } catch (error) {
                console.error(`Error fetching ${source.name}:`, error);
                return [];
            }
        }

        function renderLoading() {
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('articles-grid').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');
        }

        function renderArticles() {
            if (state.loading) {
                renderLoading();
                return;
            }
            
            let displayArticles = state.articles.filter(article => {
                // Match search query
                const matchesSearch = !state.searchQuery || 
                    article.title.toLowerCase().includes(state.searchQuery) || 
                    article.summary.toLowerCase().includes(state.searchQuery);
                
                // Match source filter
                const matchesSource = state.activeSourceId === 'all' || 
                    article.sourceName === state.config.sources.find(s => s.id === state.activeSourceId)?.name;
                
                // Match view (bookmarks or all)
                const matchesView = state.currentView !== 'bookmarks' || article.bookmarked;
                
                return matchesSearch && matchesSource && matchesView;
            });
            
            const grid = document.getElementById('articles-grid');
            const empty = document.getElementById('empty-state');
            
            if (displayArticles.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                
                if (state.currentView === 'bookmarks') {
                    empty.querySelector('h3').textContent = 'No bookmarks yet';
                    empty.querySelector('p').textContent = 'Bookmark articles by clicking the bookmark icon.';
                }
                return;
            }
            
            document.getElementById('loading-state').classList.add('hidden');
            empty.classList.add('hidden');
            grid.classList.remove('hidden');
            grid.innerHTML = '';
            
            displayArticles.forEach(article => {
                const template = document.getElementById('article-template');
                const clone = template.content.cloneNode(true);
                const articleEl = clone.querySelector('.article-card');
                
                // Set article source
                articleEl.querySelector('.article-source').textContent = article.sourceName;
                
                // Set up bookmark button
                const bookmarkBtn = articleEl.querySelector('.bookmark-btn');
                if (article.bookmarked) {
                    bookmarkBtn.classList.add('active');
                    bookmarkBtn.innerHTML = '<i class="fas fa-bookmark"></i>';
                }
                bookmarkBtn.addEventListener('click', () => toggleBookmark(article.id));
                
                // Set article title and link - DIRECT LINK TO ARTICLE
                const titleLink = articleEl.querySelector('.article-title a');
                titleLink.textContent = article.title;
                titleLink.href = article.link;
                titleLink.title = `Read full article on ${article.sourceName}`;
                
                // Set date
                articleEl.querySelector('.date-text').textContent = new Date(article.pubDate).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                // Set author
                articleEl.querySelector('.author-text').textContent = article.author;
                
                // Set summary
                articleEl.querySelector('.article-summary').textContent = article.summary;
                
                // Set "Read Full" button link - DIRECT LINK TO ARTICLE
                const readFullBtn = articleEl.querySelector('.read-full-btn');
                readFullBtn.href = article.link;
                readFullBtn.title = `Read full article on ${article.sourceName}`;
                
                // Set tags
                const tagsContainer = articleEl.querySelector('.article-tags');
                article.categories.slice(0, 3).forEach(cat => {
                    const tag = document.createElement('span');
                    tag.textContent = cat;
                    tagsContainer.appendChild(tag);
                });
                
                // Set up AI insight button
                const aiBtn = articleEl.querySelector('.ai-insight-btn');
                aiBtn.addEventListener('click', function() {
                    const insightEl = articleEl.querySelector('.ai-insight');
                    if (!insightEl.classList.contains('hidden')) return;
                    
                    this.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Generating...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        insightEl.classList.remove('hidden');
                        insightEl.querySelector('.ai-text').textContent = 
                            "AI analysis: This article discusses developments in healthcare AI with potential implications for clinical practice and patient outcomes.";
                        this.innerHTML = '<i class="fas fa-wand-magic-sparkles"></i> Insight Ready';
                        this.disabled = true;
                    }, 1500);
                });
                
                grid.appendChild(articleEl);
            });
        }

        function toggleBookmark(articleId) {
            if (state.bookmarks.has(articleId)) {
                state.bookmarks.delete(articleId);
            } else {
                state.bookmarks.add(articleId);
            }
            
            // Update article in state
            state.articles = state.articles.map(article => 
                article.id === articleId ? { ...article, bookmarked: !article.bookmarked } : article
            );
            
            // Update UI if article is currently displayed
            const articleEl = document.querySelector(`[data-id="${articleId}"]`);
            if (articleEl) {
                const bookmarkBtn = articleEl.querySelector('.bookmark-btn');
                bookmarkBtn.classList.toggle('active');
                bookmarkBtn.innerHTML = state.bookmarks.has(articleId) 
                    ? '<i class="fas fa-bookmark"></i>' 
                    : '<i class="far fa-bookmark"></i>';
            }
            
            renderSidebar();
            saveState();
            
            // Re-render if we're in bookmarks view
            if (state.currentView === 'bookmarks') {
                renderArticles();
            }
        }

        function renderSidebar() {
            // Update unread count
            const unread = state.articles.filter(a => !state.bookmarks.has(a.id)).length;
            document.getElementById('unread-count').textContent = unread > 99 ? '99+' : unread;
            
            // Render source list in Focus Areas
            const sourceList = document.getElementById('source-list');
            sourceList.innerHTML = '';
            
            state.config.sources.forEach(source => {
                if (!source.enabled) return;
                
                const btn = document.createElement('button');
                btn.className = 'nav-item source-item';
                if (state.activeSourceId === source.id) {
                    btn.classList.add('active');
                }
                
                btn.dataset.source = source.id;
                btn.innerHTML = `
                    <div class="nav-item-content">
                        <div class="source-dot"></div>
                        <span class="source-name">${source.name}</span>
                    </div>
                `;
                
                btn.addEventListener('click', () => {
                    // Update active states
                    document.querySelectorAll('.source-item').forEach(item => item.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update all topics button
                    document.querySelector('[data-source="all"]').classList.remove('active');
                    
                    // Set filter and render
                    state.activeSourceId = source.id;
                    renderArticles();
                });
                
                sourceList.appendChild(btn);
            });
            
            // Add click handler for "All AI Topics" button
            const allTopicsBtn = document.querySelector('[data-source="all"]');
            allTopicsBtn.addEventListener('click', () => {
                document.querySelectorAll('.source-item').forEach(item => item.classList.remove('active'));
                allTopicsBtn.classList.add('active');
                state.activeSourceId = 'all';
                renderArticles();
            });
        }
    </script>
</body>
</html>
